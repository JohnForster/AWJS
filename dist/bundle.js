!function(t){var n={};function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:r})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var o in t)e.d(r,o,function(n){return t[n]}.bind(null,o));return r},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=0)}([function(t,n,e){"use strict";e.r(n);var r,o=function(){function t(t){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.cachedCanvas=document.createElement("canvas"),this.sprites=t.data.sprites}return t.prototype.render=function(n){var e=this;return n?(this.context.clearRect(0,0,this.canvas.width,this.canvas.height),n.idGrid.forEach(function(t,r){t.forEach(function(t,o){if(void 0!==n.idGrid[r][o]){var i=e.sprites[t],u=16*o+(i.ax||0),a=16*r+(i.ay||0);e.context.putImageData(i.imageData,u,a)}})}),this.cachedCanvas=t.cloneCanvas(this.canvas),this.canvas):this.cachedCanvas},t.cloneCanvas=function(t){var n=document.createElement("canvas"),e=n.getContext("2d");return n.width=t.width,n.height=t.height,e.drawImage(t,0,0),n},t}(),i=(r=function(t,n){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(t,n)},function(t,n){function e(){this.constructor=t}r(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}),u=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return i(n,t),n}(o),a=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),c=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return a(n,t),n}(o),s=function(){function t(t,n,e){this.logicModel=t,this.uiModel=n,this.mainCanvas=this.setupMainCanvas(),this.mainContext=this.mainCanvas.getContext("2d"),this.bgRenderer=new u(e.terrain),this.uiRenderer=new c(e.ui)}return t.prototype.render=function(){var t=this.getGameState(),n=this.getUIState(),e=this.renderGame(t),r=this.renderUI(n);this.paintToMainCanvas(e,r)},t.prototype.paintToMainCanvas=function(){for(var t=this,n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];n.forEach(function(n){t.mainContext.drawImage(n,0,0)})},t.prototype.renderGame=function(t){return this.bgRenderer.render(t)},t.prototype.renderUI=function(t){return this.uiRenderer.render(t)},t.prototype.getGameState=function(){return this.logicModel.getState()},t.prototype.getUIState=function(){return this.uiModel.getState()},t.prototype.setupMainCanvas=function(){var t=document.getElementById("canvas");return t.height=600,t.width=800,t},t}(),f=function(){function t(t){this.keyMappings={w:"up",s:"down",a:"left",d:"right"," ":"select"},this.uiModel=t,document.onkeypress=this.handleKeyPress.bind(this)}return t.prototype.handleKeyPress=function(t){var n=this.keyMappings[t.key.toLowerCase()];n&&this.uiModel.send(n)},t}(),p=function(){function t(t,n,e){for(var r=[],o=3;o<arguments.length;o++)r[o-3]=arguments[o];this.instructions={up:function(){},down:function(){},left:function(){},right:function(){},A:function(){},B:function(){},L:function(){},R:function(){},start:function(){},select:function(){}},this.position={x:t,y:n,z:e},this.init(r)}return t.prototype.init=function(t){},t.prototype.sendInstruction=function(t){this.instructions[t]()},t}(),h=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),l=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.name="cursor",n.id=0,n.instructions={up:function(){n.moveUp()},down:function(){n.moveDown()},left:function(){n.moveLeft()},right:function(){n.moveRight()}},n}return h(n,t),n.prototype.moveUp=function(t){void 0===t&&(t=1),this.position.y>0&&(this.position.y-=t)},n.prototype.moveDown=function(t){void 0===t&&(t=1),this.position.y+=t},n.prototype.moveLeft=function(t){void 0===t&&(t=1),this.position.x>0&&(this.position.x-=t)},n.prototype.moveRight=function(t){void 0===t&&(t=1),this.position.x+=t},n}(p),d=function(){function t(t){this.currentUIState={idGrid:Array.from(Array(32),function(t){return Array(32)})},this.objects=[],console.log(this.currentUIState),this.gameState=t.getState(),this.cursor=this.create(l,{x:0,y:0,z:0}),this.select(this.cursor),this.refreshState()}return t.prototype.send=function(t){this.selectedObject.sendInstruction(t);var n=this.selectedObject.position,e=n.x,r=n.y;this.refreshState(),this.currentUIState.idGrid[r][e]=this.selectedObject.id},t.prototype.create=function(t,n,e){var r=new t(n.x,n.y,n.z);return e&&e(r),this.objects.push(r),r},t.prototype.refreshState=function(){var t=this;this.currentUIState.idGrid=Array.from(Array(32),function(t){return Array(32)}),this.objects=this.objects.sort(function(t,n){return t.position.z-n.position.z}),this.objects.forEach(function(n){var e=n.position,r=e.x,o=e.y;t.currentUIState.idGrid[o][r]=n.id})},t.prototype.getState=function(){return this.currentUIState},t.prototype.select=function(t){this.selectedObject=t||this.cursor},t}(),y=function(){function t(){}return t.prototype.getState=function(){},t}(),v=function(){function t(){this.logicModel=new y}return t.prototype.getState=function(){return{idGrid:[[1,1,0,1,0,1],[1,1,0,1,0,1],[1,1,0,1,0,1],[1,1,0,1,0,1],[1,1,0,1,0,1],[1,1,0,1,0,1]]}},t}(),g=function(t,n,e,r){return new(e||(e=Promise))(function(o,i){function u(t){try{c(r.next(t))}catch(t){i(t)}}function a(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){t.done?o(t.value):new e(function(n){n(t.value)}).then(u,a)}c((r=r.apply(t,n||[])).next())})},m=function(t,n){var e,r,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;u;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,r=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=n.call(t,u)}catch(t){i=[6,t],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},w=function(){function t(){}return t.load=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return g(this,void 0,void 0,function(){var e=this;return m(this,function(r){return n.forEach(function(n){return g(e,void 0,void 0,function(){var e,r,o,i;return m(this,function(u){switch(u.label){case 0:return[4,t.addImageProcess(n.path)];case 1:for(o in e=u.sent(),r=t.getContext(e),n.data.sprites)(i=n.data.sprites[o]).imageData=t.getImageData(i,r);return[2]}})})}),[2]})})},t.getContext=function(n){var e=t.setupCanvas(n).getContext("2d");return e.drawImage(n,0,0),e},t.setupCanvas=function(t){var n=document.createElement("canvas");return n.width=t.width,n.height=t.height,n},t.addImageProcess=function(t){return new Promise(function(n,e){var r=new Image;r.onload=function(){return n(r)},r.onerror=function(t){return e(t)},r.src=t})},t.getImageData=function(t,n){var e=t.x,r=t.y,o=t.w,i=t.h;return n.getImageData(e,r,o,i)},t}(),b={path:"assets/terrain/spriteSheet.png",data:{type:"terrain",sprites:{0:{name:"grass",x:217,y:1567,w:16,h:16},1:{name:"sea",x:340,y:1567,w:16,h:16}}}},x={path:"assets/ui/UISprites.png",data:{type:"UI",sprites:{0:{name:"cursor",x:44,y:6,w:28,h:31,ax:-3,ay:-3}}}},S=function(t,n,e,r){return new(e||(e=Promise))(function(o,i){function u(t){try{c(r.next(t))}catch(t){i(t)}}function a(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){t.done?o(t.value):new e(function(n){n(t.value)}).then(u,a)}c((r=r.apply(t,n||[])).next())})},_=function(t,n){var e,r,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;u;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,r=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=n.call(t,u)}catch(t){i=[6,t],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},I=function(){function t(){this.logicModel=new v,this.uiModel=new d(this.logicModel),this.view=new s(this.logicModel,this.uiModel,{terrain:b,ui:x}),this.controller=new f(this.uiModel),this.performAsyncSetup()}return t.prototype.performAsyncSetup=function(){return S(this,void 0,void 0,function(){return _(this,function(t){switch(t.label){case 0:return[4,Promise.all([w.load(b,x)])];case 1:return t.sent(),this.runGame(),[2]}})})},t.prototype.runGame=function(){var t=this;setInterval(function(){t.view.render()},1e3/30)},t}();(new(function(){function t(){}return t.prototype.run=function(){new I},t}())).run()}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2dhbWVFbmdpbmVfMi92aWV3L3N1YnJlbmRlcmVycy9zdWJyZW5kZXJlci50cyIsIndlYnBhY2s6Ly8vLi9zcmMvZ2FtZUVuZ2luZV8yL3ZpZXcvc3VicmVuZGVyZXJzL2JnUmVuZGVyZXIvYmdSZW5kZXJlci50cyIsIndlYnBhY2s6Ly8vLi9zcmMvZ2FtZUVuZ2luZV8yL3ZpZXcvc3VicmVuZGVyZXJzL3VpUmVuZGVyZXIvdWlSZW5kZXJlci50cyIsIndlYnBhY2s6Ly8vLi9zcmMvZ2FtZUVuZ2luZV8yL3ZpZXcvdmlldy50cyIsIndlYnBhY2s6Ly8vLi9zcmMvZ2FtZUVuZ2luZV8yL2NvbnRyb2xsZXIvY29udHJvbGxlci50cyIsIndlYnBhY2s6Ly8vLi9zcmMvZ2FtZUVuZ2luZV8yL21vZGVsL3VpTW9kZWwvdWlPYmplY3RzL3VpT2JqZWN0LnRzIiwid2VicGFjazovLy8uL3NyYy9nYW1lRW5naW5lXzIvbW9kZWwvdWlNb2RlbC91aU9iamVjdHMvY3Vyc29yL2N1cnNvci50cyIsIndlYnBhY2s6Ly8vLi9zcmMvZ2FtZUVuZ2luZV8yL21vZGVsL3VpTW9kZWwvdWlNb2RlbC50cyIsIndlYnBhY2s6Ly8vLi9zcmMvZ2FtZUVuZ2luZV8yL21vZGVsL2xvZ2ljTW9kZWwvbG9naWNNb2RlbC50cyIsIndlYnBhY2s6Ly8vLi9zcmMvZ2FtZUVuZ2luZV8yL21vZGVsL2xvZ2ljTW9kZWwvbWVkaWF0b3IvbWVkaWF0b3IudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2dhbWVFbmdpbmVfMi92aWV3L3N1YnJlbmRlcmVycy9pbWFnZUxvYWRlci9pbWFnZUxvYWRlci50cyIsIndlYnBhY2s6Ly8vLi9zcmMvYXNzZXRzL3RlcnJhaW4vdGVycmFpbnNoZWV0RGF0YS50cyIsIndlYnBhY2s6Ly8vLi9zcmMvYXNzZXRzL3VpL3VpU2hlZXREYXRhLnRzIiwid2VicGFjazovLy8uL3NyYy9nYW1lRW5naW5lXzIvZW5naW5lLnRzIiwid2VicGFjazovLy8uL3NyYy9hcHAvYXBwLnRzIiwid2VicGFjazovLy8uL3NyYy9pbmRleC50cyJdLCJuYW1lcyI6WyJpbnN0YWxsZWRNb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiZXhwb3J0cyIsIm1vZHVsZSIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsIlN1YnJlbmRlcmVyIiwic3ByaXRlc2hlZXREYXRhIiwidGhpcyIsImNhbnZhcyIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImNvbnRleHQiLCJnZXRDb250ZXh0IiwiY2FjaGVkQ2FudmFzIiwic3ByaXRlcyIsImRhdGEiLCJyZW5kZXIiLCJzdGF0ZSIsIl90aGlzIiwiY2xlYXJSZWN0Iiwid2lkdGgiLCJoZWlnaHQiLCJpZEdyaWQiLCJmb3JFYWNoIiwicm93Iiwicm93TnVtYmVyIiwiaWQiLCJjb2xOdW1iZXIiLCJ1bmRlZmluZWQiLCJzcHJpdGUiLCJ4IiwiYXgiLCJ5IiwiYXkiLCJwdXRJbWFnZURhdGEiLCJpbWFnZURhdGEiLCJjbG9uZUNhbnZhcyIsIm9sZENhbnZhcyIsIm5ld0NhbnZhcyIsImRyYXdJbWFnZSIsIl9zdXBlciIsIkJnUmVuZGVyZXIiLCJfX2V4dGVuZHMiLCJzdWJyZW5kZXJlciIsIlVJUmVuZGVyZXIiLCJ1aVJlbmRlcmVyX2V4dGVuZHMiLCJWaWV3IiwibG9naWNNb2RlbCIsInVpTW9kZWwiLCJzcHJpdGVzaGVldHMiLCJtYWluQ2FudmFzIiwic2V0dXBNYWluQ2FudmFzIiwibWFpbkNvbnRleHQiLCJiZ1JlbmRlcmVyIiwidGVycmFpbiIsInVpUmVuZGVyZXIiLCJ1aSIsImdhbWVTdGF0ZSIsImdldEdhbWVTdGF0ZSIsInVpU3RhdGUiLCJnZXRVSVN0YXRlIiwiZ2FtZUNhbnZhcyIsInJlbmRlckdhbWUiLCJ1aUNhbnZhcyIsInJlbmRlclVJIiwicGFpbnRUb01haW5DYW52YXMiLCJjYW52YXNlcyIsIl9pIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwiZ2V0U3RhdGUiLCJnZXRFbGVtZW50QnlJZCIsIkNvbnRyb2xsZXIiLCJrZXlNYXBwaW5ncyIsInciLCJhIiwiICIsIm9ua2V5cHJlc3MiLCJoYW5kbGVLZXlQcmVzcyIsImUiLCJpbnB1dCIsInRvTG93ZXJDYXNlIiwic2VuZCIsIlVJT2JqZWN0IiwieiIsImFyZ3MiLCJpbnN0cnVjdGlvbnMiLCJ1cCIsImRvd24iLCJsZWZ0IiwicmlnaHQiLCJBIiwiQiIsIkwiLCJSIiwic3RhcnQiLCJzZWxlY3QiLCJwb3NpdGlvbiIsImluaXQiLCJzZW5kSW5zdHJ1Y3Rpb24iLCJpbnN0cnVjdGlvbiIsIkN1cnNvciIsImFwcGx5IiwibW92ZVVwIiwibW92ZURvd24iLCJtb3ZlTGVmdCIsIm1vdmVSaWdodCIsImN1cnNvcl9leHRlbmRzIiwidWlPYmplY3QiLCJVSU1vZGVsIiwiY3VycmVudFVJU3RhdGUiLCJBcnJheSIsImZyb20iLCJvYmplY3RzIiwiY29uc29sZSIsImxvZyIsImN1cnNvciIsInJlZnJlc2hTdGF0ZSIsInNlbGVjdGVkT2JqZWN0IiwiX2EiLCJVSU9iamVjdENsYXNzIiwic2V0dXBGbiIsInB1c2giLCJzb3J0IiwiYiIsIkxvZ2ljTW9kZWwiLCJNZWRpYXRvciIsImxvZ2ljTW9kZWxfbG9naWNNb2RlbCIsIkltYWdlTG9hZGVyIiwibG9hZCIsInNwcml0ZXNoZWV0RGF0YUFycmF5IiwiX19hd2FpdGVyIiwiYWRkSW1hZ2VQcm9jZXNzIiwicGF0aCIsInNwcml0ZXNoZWV0Iiwic2VudCIsInRlbXBDb250ZXh0IiwiZ2V0SW1hZ2VEYXRhIiwiaW1hZ2UiLCJzZXR1cENhbnZhcyIsInNyYyIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiaW1nIiwiSW1hZ2UiLCJvbmxvYWQiLCJvbmVycm9yIiwiZXJyIiwiaCIsInRlcnJhaW5fdGVycmFpbnNoZWV0RGF0YSIsInR5cGUiLCIwIiwiMSIsInVpU2hlZXREYXRhIiwiRW5naW5lIiwibWVkaWF0b3IiLCJ1aU1vZGVsX3VpTW9kZWwiLCJ2aWV3IiwiY29udHJvbGxlciIsInBlcmZvcm1Bc3luY1NldHVwIiwiYWxsIiwiaW1hZ2VMb2FkZXIiLCJydW5HYW1lIiwic2V0SW50ZXJ2YWwiLCJBcHAiLCJydW4iLCJnYW1lRW5naW5lXzJfZW5naW5lIl0sIm1hcHBpbmdzIjoiYUFDQSxJQUFBQSxFQUFBLEdBR0EsU0FBQUMsRUFBQUMsR0FHQSxHQUFBRixFQUFBRSxHQUNBLE9BQUFGLEVBQUFFLEdBQUFDLFFBR0EsSUFBQUMsRUFBQUosRUFBQUUsR0FBQSxDQUNBRyxFQUFBSCxFQUNBSSxHQUFBLEVBQ0FILFFBQUEsSUFVQSxPQU5BSSxFQUFBTCxHQUFBTSxLQUFBSixFQUFBRCxRQUFBQyxJQUFBRCxRQUFBRixHQUdBRyxFQUFBRSxHQUFBLEVBR0FGLEVBQUFELFFBS0FGLEVBQUFRLEVBQUFGLEVBR0FOLEVBQUFTLEVBQUFWLEVBR0FDLEVBQUFVLEVBQUEsU0FBQVIsRUFBQVMsRUFBQUMsR0FDQVosRUFBQWEsRUFBQVgsRUFBQVMsSUFDQUcsT0FBQUMsZUFBQWIsRUFBQVMsRUFBQSxDQUEwQ0ssWUFBQSxFQUFBQyxJQUFBTCxLQUsxQ1osRUFBQWtCLEVBQUEsU0FBQWhCLEdBQ0Esb0JBQUFpQixlQUFBQyxhQUNBTixPQUFBQyxlQUFBYixFQUFBaUIsT0FBQUMsWUFBQSxDQUF3REMsTUFBQSxXQUV4RFAsT0FBQUMsZUFBQWIsRUFBQSxjQUFpRG1CLE9BQUEsS0FRakRyQixFQUFBc0IsRUFBQSxTQUFBRCxFQUFBRSxHQUVBLEdBREEsRUFBQUEs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b2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAwKTtcbiIsImltcG9ydCBJbWFnZUxvYWRlciBmcm9tICcuL2ltYWdlTG9hZGVyL2ltYWdlTG9hZGVyJ1xuaW1wb3J0IElTcHJpdGVzaGVldERhdGEgZnJvbSAnc3JjL2Fzc2V0cy9JU3ByaXRlc2hlZXREYXRhJ1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTdWJyZW5kZXJlciB7XG4gIHNwcml0ZXM6IElTcHJpdGVzaGVldERhdGFbJ2RhdGEnXVsnc3ByaXRlcyddO1xuICBjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50O1xuICBjb250ZXh0OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQ7XG4gIGNhY2hlZENhbnZhczogSFRNTENhbnZhc0VsZW1lbnQ7XG5cbiAgY29uc3RydWN0b3Ioc3ByaXRlc2hlZXREYXRhOiBJU3ByaXRlc2hlZXREYXRhKXtcbiAgICB0aGlzLmNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpXG4gICAgdGhpcy5jb250ZXh0ID0gdGhpcy5jYW52YXMuZ2V0Q29udGV4dCgnMmQnKVxuICAgIHRoaXMuY2FjaGVkQ2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJylcbiAgICB0aGlzLnNwcml0ZXMgPSBzcHJpdGVzaGVldERhdGEuZGF0YS5zcHJpdGVzXG4gIH1cblxuICByZW5kZXIoc3RhdGU/OiBJU3RhdGUpOiBIVE1MQ2FudmFzRWxlbWVudCB7XG5cbiAgICAvLyBSZXR1cm4gdGhlIGNhY2hlZCBjYW52YXMgaWYgbm8gbmV3IHN0YXRlIGhhcyBiZWVuIGdpdmVuXG4gICAgaWYgKCFzdGF0ZSkgcmV0dXJuIHRoaXMuY2FjaGVkQ2FudmFzXG5cbiAgICAvLyBDbGVhciB0aGUgZXhpc3RpbmcgY2FudmFzIGNvbnRleHQgXG4gICAgdGhpcy5jb250ZXh0LmNsZWFyUmVjdCgwLDAsIHRoaXMuY2FudmFzLndpZHRoLCB0aGlzLmNhbnZhcy5oZWlnaHQpXG5cbiAgICAvLyBDeWNsZSB0aHJvdWdoIHRoZSBzdGF0ZSdzIGlkR3JpZCBhbmQgcmVuZGVyIGVhY2ggc3ByaXRlIHRvIHRoZSBjb250ZXh0XG4gICAgc3RhdGUuaWRHcmlkLmZvckVhY2goKHJvdywgcm93TnVtYmVyKSA9PiB7XG4gICAgICByb3cuZm9yRWFjaCgoaWQsIGNvbE51bWJlcikgPT4ge1xuICAgICAgICBpZiAoc3RhdGUuaWRHcmlkW3Jvd051bWJlcl1bY29sTnVtYmVyXSAhPT0gdW5kZWZpbmVkKXtcbiAgICAgICAgICBjb25zdCBzcHJpdGUgPSB0aGlzLnNwcml0ZXNbaWRdXG4gICAgICAgICAgY29uc3QgeCA9IGNvbE51bWJlciAqIDE2ICsgKHNwcml0ZS5heCB8fCAwKSAvLyBUaWxlIHdpZHRoIChnZXQgZnJvbSB3aGVyZT8pXG4gICAgICAgICAgY29uc3QgeSA9IHJvd051bWJlciAqIDE2ICsgKHNwcml0ZS5heSB8fCAwKVxuICAgICAgICAgIHRoaXMuY29udGV4dC5wdXRJbWFnZURhdGEoc3ByaXRlLmltYWdlRGF0YSwgeCwgeSlcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9KVxuXG4gICAgLy8gQ2FjaGUgdGhpcyBjYW52YXMgZm9yIGZ1dHVyZSB1c2VcbiAgICB0aGlzLmNhY2hlZENhbnZhcyA9IFN1YnJlbmRlcmVyLmNsb25lQ2FudmFzKHRoaXMuY2FudmFzKVxuXG4gICAgcmV0dXJuIHRoaXMuY2FudmFzXG4gIH1cblxuICBzdGF0aWMgY2xvbmVDYW52YXMob2xkQ2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudCkge1xuICAgIFxuICAgIC8vY3JlYXRlIGEgbmV3IGNhbnZhc1xuICAgIHZhciBuZXdDYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcbiAgICB2YXIgY29udGV4dCA9IG5ld0NhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuXG4gICAgLy9zZXQgZGltZW5zaW9uc1xuICAgIG5ld0NhbnZhcy53aWR0aCA9IG9sZENhbnZhcy53aWR0aDtcbiAgICBuZXdDYW52YXMuaGVpZ2h0ID0gb2xkQ2FudmFzLmhlaWdodDtcblxuICAgIC8vYXBwbHkgdGhlIG9sZCBjYW52YXMgdG8gdGhlIG5ldyBvbmVcbiAgICBjb250ZXh0LmRyYXdJbWFnZShvbGRDYW52YXMsIDAsIDApO1xuXG4gICAgLy9yZXR1cm4gdGhlIG5ldyBjYW52YXNcbiAgICByZXR1cm4gbmV3Q2FudmFzO1xuICB9XG59IiwiaW1wb3J0IFN1YnJlbmRlcmVyIGZyb20gJy4uL3N1YnJlbmRlcmVyJ1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBCZ1JlbmRlcmVyIGV4dGVuZHMgU3VicmVuZGVyZXIge30gLy8gQWRkIGFueSBiZyBzcGVjaWZpYyByZW5kZXJpbmciLCJpbXBvcnQgU3VicmVuZGVyZXIgZnJvbSAnLi4vc3VicmVuZGVyZXInXG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFVJUmVuZGVyZXIgZXh0ZW5kcyBTdWJyZW5kZXJlciB7XG4gIC8vIFJlbmRlciBhY2NvcmRpbmcgdG8gVUkgbGF5ZXI/IGllIHotdmFsdWVcbn0gLy8gQWRkIGFueSBVSSBzcGVjaWZpYyByZW5kZXJpbmdcbiIsImltcG9ydCBCZ1JlbmRlcmVyIGZyb20gJy4vc3VicmVuZGVyZXJzL2JnUmVuZGVyZXIvYmdSZW5kZXJlcidcbmltcG9ydCBVSVJlbmRlcmVyIGZyb20gJy4vc3VicmVuZGVyZXJzL3VpUmVuZGVyZXIvdWlSZW5kZXJlcic7XG5pbXBvcnQgVUlNb2RlbCBmcm9tICcuLi9tb2RlbC91aU1vZGVsL3VpTW9kZWwnO1xuaW1wb3J0IExvZ2ljTW9kZWwgZnJvbSAnLi4vbW9kZWwvbG9naWNNb2RlbC9sb2dpY01vZGVsJztcbmltcG9ydCBJU3ByaXRlc2hlZXREYXRhIGZyb20gJy4uLy4uL2Fzc2V0cy9JU3ByaXRlc2hlZXREYXRhJztcbi8vIGltcG9ydCBVbml0UmVuZGVyZXIgZnJvbSAnLi9zdWJyZW5kZXJlcnMvdW5pdFJlbmRlcmVyLnRzL3VuaXRSZW5kZXJlcic7XG5cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVmlldyB7XG4gIGJnUmVuZGVyZXI6IEJnUmVuZGVyZXI7XG4gIHVpUmVuZGVyZXI6IFVJUmVuZGVyZXI7XG4gIHVuaXRSZW5kZXJlcjogYW55O1xuICB1aU1vZGVsOiBVSU1vZGVsO1xuICBsb2dpY01vZGVsOiBMb2dpY01vZGVsO1xuICBtYWluQ2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudDtcbiAgbWFpbkNvbnRleHQ6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRDtcblxuICBjb25zdHJ1Y3Rvcihsb2dpY01vZGVsOiBMb2dpY01vZGVsLCB1aU1vZGVsOlVJTW9kZWwsIHNwcml0ZXNoZWV0czp7W2tleTpzdHJpbmddOklTcHJpdGVzaGVldERhdGF9KSB7XG4gICAgdGhpcy5sb2dpY01vZGVsID0gbG9naWNNb2RlbFxuICAgIHRoaXMudWlNb2RlbCA9IHVpTW9kZWxcblxuICAgIHRoaXMubWFpbkNhbnZhcyA9IHRoaXMuc2V0dXBNYWluQ2FudmFzKClcbiAgICB0aGlzLm1haW5Db250ZXh0ID0gdGhpcy5tYWluQ2FudmFzLmdldENvbnRleHQoJzJkJylcblxuICAgIHRoaXMuYmdSZW5kZXJlciA9IG5ldyBCZ1JlbmRlcmVyKHNwcml0ZXNoZWV0cy50ZXJyYWluKVxuICAgIHRoaXMudWlSZW5kZXJlciA9IG5ldyBVSVJlbmRlcmVyKHNwcml0ZXNoZWV0cy51aSlcbiAgICAvLyB0aGlzLnVuaXRSZW5kZXJlciA9IG5ldyBVbml0UmVuZGVyZXIoc3ByaXRlc2hlZXRzLnVuaXRzKVxuICB9XG5cbiAgcmVuZGVyICgpIHtcbiAgICAvLyBRdWVzdGlvbiAtIHRoZSB2YXJpYWJsZXMgZGVmaW5lZCBoZXJlIGFyZSBwdXJlbHkgZm9yIHJlYWRhYmlsaXR5LFxuICAgIC8vICB3b3VsZCBpdCBiZSBiZXR0ZXIgdG8gdXNlIGEgZnVuY3Rpb25hbCBzdHlsZSBoZXJlP1xuICAgIGNvbnN0IGdhbWVTdGF0ZSA9IHRoaXMuZ2V0R2FtZVN0YXRlKClcbiAgICBjb25zdCB1aVN0YXRlID0gdGhpcy5nZXRVSVN0YXRlKClcbiAgICBjb25zdCBnYW1lQ2FudmFzID0gdGhpcy5yZW5kZXJHYW1lKGdhbWVTdGF0ZSlcbiAgICAvLyBVbmNvbW1lbnQgd2hlbiBVSSBpcyByZWFkeSB0byBiZSByZW5kZXJlZFxuICAgIGNvbnN0IHVpQ2FudmFzID0gdGhpcy5yZW5kZXJVSSh1aVN0YXRlKVxuICAgIHRoaXMucGFpbnRUb01haW5DYW52YXMoZ2FtZUNhbnZhcywgdWlDYW52YXMpXG4gICAgLy8gdGhpcy5wYWludFRvTWFpbkNhbnZhcyhnYW1lQ2FudmFzKVxuICB9XG5cbiAgcHJpdmF0ZSBwYWludFRvTWFpbkNhbnZhcyguLi5jYW52YXNlczogSFRNTENhbnZhc0VsZW1lbnRbXSl7XG4gICAgY2FudmFzZXMuZm9yRWFjaCgoY2FudmFzKSA9PiB7XG4gICAgICB0aGlzLm1haW5Db250ZXh0LmRyYXdJbWFnZShjYW52YXMsIDAsIDApXG4gICAgfSlcbiAgfVxuXG4gIHByaXZhdGUgcmVuZGVyR2FtZShnYW1lU3RhdGU6SVN0YXRlKTogSFRNTENhbnZhc0VsZW1lbnR7XG4gICAgcmV0dXJuIHRoaXMuYmdSZW5kZXJlci5yZW5kZXIoZ2FtZVN0YXRlKVxuICB9XG5cbiAgcHJpdmF0ZSByZW5kZXJVSSh1aVN0YXRlOiBJU3RhdGUpOiBIVE1MQ2FudmFzRWxlbWVudCB7XG4gICAgcmV0dXJuIHRoaXMudWlSZW5kZXJlci5yZW5kZXIodWlTdGF0ZSlcbiAgfVxuXG4gIHByaXZhdGUgZ2V0R2FtZVN0YXRlKCl7XG4gICAgcmV0dXJuIHRoaXMubG9naWNNb2RlbC5nZXRTdGF0ZSgpXG4gIH1cblxuICBwcml2YXRlIGdldFVJU3RhdGUoKXtcbiAgICByZXR1cm4gdGhpcy51aU1vZGVsLmdldFN0YXRlKClcbiAgfVxuXG4gIHByaXZhdGUgc2V0dXBNYWluQ2FudmFzKCk6IEhUTUxDYW52YXNFbGVtZW50IHtcbiAgICBjb25zdCBjYW52YXMgPSA8SFRNTENhbnZhc0VsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbnZhcycpO1xuICAgIGNhbnZhcy5oZWlnaHQgPSA2MDA7IC8vIHNldCBkaW1lbnNpb25zIGluIGNvbmZpZz9cbiAgICBjYW52YXMud2lkdGggPSA4MDA7XG4gICAgcmV0dXJuIGNhbnZhcztcbiAgfVxufSIsImltcG9ydCBVSU1vZGVsIGZyb20gXCIuLi9tb2RlbC91aU1vZGVsL3VpTW9kZWxcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ29udHJvbGxlciB7XG4gIHVpTW9kZWw6IFVJTW9kZWw7XG5cbiAga2V5TWFwcGluZ3M6IHtba2V5bmFtZTogc3RyaW5nXTogc3RyaW5nfSA9IHtcbiAgICB3OiAndXAnLCAvLyB3XG4gICAgczogJ2Rvd24nLCAvLyBzXG4gICAgYTogJ2xlZnQnLCAvLyBhXG4gICAgZDogJ3JpZ2h0JywgLy8gZFxuICAgICcgJzogJ3NlbGVjdCcsIC8vIHNwYWNlXG4gIH1cblxuICBjb25zdHJ1Y3Rvcih1aU1vZGVsOiBVSU1vZGVsKXtcbiAgICB0aGlzLnVpTW9kZWwgPSB1aU1vZGVsXG4gICAgZG9jdW1lbnQub25rZXlwcmVzcyA9IHRoaXMuaGFuZGxlS2V5UHJlc3MuYmluZCh0aGlzKVxuICB9XG5cbiAgaGFuZGxlS2V5UHJlc3MoZTogS2V5Ym9hcmRFdmVudCl7XG4gICAgLy8gVGhpbmsgb2YgYSBzb2x1dGlvbiB0byBkZWFsIHdpdGggbXVsdGlwbGUga2V5IHByZXNzZXM/IChFZy4gaG9sZGluZyBCIHRvIHNlZSB0aGUgcmFuZ2VcbiAgICAvLyAgb2YgdGhlIHVuaXQsIGFuZCB1c2luZyB0aGUgYXJyb3cga2V5cyB0byBuYXZpZ2F0ZSBhcm91bmQgdGhlIG1hcD8pXG4gICAgY29uc3QgaW5wdXQgPSB0aGlzLmtleU1hcHBpbmdzW2Uua2V5LnRvTG93ZXJDYXNlKCldXG4gICAgaWYoaW5wdXQpe1xuICAgICAgdGhpcy51aU1vZGVsLnNlbmQoaW5wdXQpXG4gICAgfVxuICB9XG59IiwiZXhwb3J0IGRlZmF1bHQgYWJzdHJhY3QgY2xhc3MgVUlPYmplY3Qge1xuICBwb3NpdGlvbjoge1xuICAgIHg6IG51bWJlcixcbiAgICB5OiBudW1iZXIsXG4gICAgejogbnVtYmVyLFxuICB9XG4gIG5hbWU6c3RyaW5nXG4gIGlkOiBudW1iZXJcblxuICBpbnN0cnVjdGlvbnM6IHtba2V5OnN0cmluZ106IEZ1bmN0aW9ufSA9IHtcbiAgICB1cDogKCkgPT4ge30sXG4gICAgZG93bjogKCkgPT4ge30sXG4gICAgbGVmdDogKCkgPT4ge30sXG4gICAgcmlnaHQ6ICgpID0+IHt9LFxuICAgIEE6ICgpID0+IHt9LFxuICAgIEI6ICgpID0+IHt9LFxuICAgIEw6ICgpID0+IHt9LFxuICAgIFI6ICgpID0+IHt9LFxuICAgIHN0YXJ0OiAoKSA9PiB7fSxcbiAgICBzZWxlY3Q6ICgpID0+IHt9LFxuICB9XG5cbiAgY29uc3RydWN0b3IoeDpudW1iZXIsIHk6bnVtYmVyLCB6Om51bWJlciwgLi4uYXJnczphbnkpIHtcbiAgICB0aGlzLnBvc2l0aW9uID0ge3g6IHgsIHk6IHksIHo6IHp9XG4gICAgdGhpcy5pbml0KGFyZ3MpXG4gIH1cblxuICBpbml0KGFyZ3M6IGFueVtdKTogdm9pZCB7fTtcblxuICBzZW5kSW5zdHJ1Y3Rpb24oaW5zdHJ1Y3Rpb246c3RyaW5nKSB7XG4gICAgdGhpcy5pbnN0cnVjdGlvbnNbaW5zdHJ1Y3Rpb25dKClcbiAgfVxufSIsImltcG9ydCBVSU9iamVjdCBmcm9tIFwiLi4vdWlPYmplY3RcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ3Vyc29yIGV4dGVuZHMgVUlPYmplY3Qge1xuICAvLyBoYXZlIGEgbGF5ZXIgKHotdmFsdWUpIGFzc29jaWF0ZWQgd2l0aCB1aU9iamVjdHMgYW5kIHJlbmRlciB0aGVtIGluIG9yZGVyP1xuICBuYW1lOiBzdHJpbmcgPSAnY3Vyc29yJ1xuICBpZDogbnVtYmVyID0gMFxuICBpbnN0cnVjdGlvbnM6IHtba2V5OnN0cmluZ106IEZ1bmN0aW9ufSA9IHtcbiAgICB1cDogKCkgPT4geyB0aGlzLm1vdmVVcCgpIH0sXG4gICAgZG93bjogKCkgPT4geyB0aGlzLm1vdmVEb3duKCkgfSxcbiAgICBsZWZ0OiAoKSA9PiB7IHRoaXMubW92ZUxlZnQoKSB9LFxuICAgIHJpZ2h0OiAoKSA9PiB7IHRoaXMubW92ZVJpZ2h0KCkgfSxcbiAgfVxuXG4gIG1vdmVVcChuOm51bWJlciA9IDEpe1xuICAgIGlmICh0aGlzLnBvc2l0aW9uLnkgPiAwKSB0aGlzLnBvc2l0aW9uLnkgLT0gblxuICB9XG4gIG1vdmVEb3duKG46bnVtYmVyID0gMSl7XG4gICAgdGhpcy5wb3NpdGlvbi55ICs9IG5cbiAgfVxuICBtb3ZlTGVmdChuOm51bWJlciA9IDEpe1xuICAgIGlmICh0aGlzLnBvc2l0aW9uLnggPiAwKSB0aGlzLnBvc2l0aW9uLnggLT0gblxuICB9XG4gIG1vdmVSaWdodChuOm51bWJlciA9IDEpe1xuICAgIHRoaXMucG9zaXRpb24ueCArPSBuXG4gIH1cbn0iLCJpbXBvcnQgTG9naWNNb2RlbCBmcm9tIFwiLi4vbG9naWNNb2RlbC9sb2dpY01vZGVsXCI7XG5pbXBvcnQgVUlPYmplY3QgZnJvbSBcIi4vdWlPYmplY3RzL3VpT2JqZWN0XCI7XG5pbXBvcnQgQ3Vyc29yIGZyb20gXCIuL3VpT2JqZWN0cy9jdXJzb3IvY3Vyc29yXCI7XG5cbi8vIFRoaXMgY2xhc3MgaXMgcmVzcG9uc2libGUgZm9yIG1hbmlwdWxhdGluZyB0aGUgVUkgc3RhdGUuIE1vdmluZyBjdXJzb3IgYXJvdW5kLFxuLy8gIHNlbGVjdGluZyB1bml0cywgY2hlY2tpbmcgdW5pdHMgZXRjLlxuXG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFVJTW9kZWx7XG4gIC8vIFRPRE8gV2hlcmUgZG8gd2UgZ2V0IHRoZSBncmlkIHNpemUgZnJvbT9cbiAgY3VycmVudFVJU3RhdGU6IElTdGF0ZSA9IHtpZEdyaWQ6IEFycmF5LmZyb20oQXJyYXkoMzIpLCB4ID0+IEFycmF5KDMyKSl9XG4gIGdhbWVTdGF0ZTogSVN0YXRlXG4gIHNlbGVjdGVkT2JqZWN0OiBVSU9iamVjdDtcbiAgb2JqZWN0czogVUlPYmplY3RbXSA9IFtdO1xuICBjdXJzb3I6IFVJT2JqZWN0O1xuXG4gIGNvbnN0cnVjdG9yIChsb2dpY01vZGVsOkxvZ2ljTW9kZWwpe1xuICAgIGNvbnNvbGUubG9nKHRoaXMuY3VycmVudFVJU3RhdGUpXG4gICAgdGhpcy5nYW1lU3RhdGUgPSBsb2dpY01vZGVsLmdldFN0YXRlKClcbiAgICB0aGlzLmN1cnNvciA9IHRoaXMuY3JlYXRlKEN1cnNvciwge3g6IDAsIHk6IDAsIHo6IDB9KVxuICAgIHRoaXMuc2VsZWN0KHRoaXMuY3Vyc29yKVxuICAgIHRoaXMucmVmcmVzaFN0YXRlKClcbiAgfVxuXG4gIHNlbmQgKGluc3RydWN0aW9uOnN0cmluZyl7XG4gICAgdGhpcy5zZWxlY3RlZE9iamVjdC5zZW5kSW5zdHJ1Y3Rpb24oaW5zdHJ1Y3Rpb24pXG4gICAgY29uc3Qge3gsIHl9ID0gdGhpcy5zZWxlY3RlZE9iamVjdC5wb3NpdGlvblxuICAgIHRoaXMucmVmcmVzaFN0YXRlKClcbiAgICB0aGlzLmN1cnJlbnRVSVN0YXRlLmlkR3JpZFt5XVt4XSA9IHRoaXMuc2VsZWN0ZWRPYmplY3QuaWQgLy8gQXdmdWwgY29kZVxuICB9XG5cblxuICBjcmVhdGUgPFQgZXh0ZW5kcyBVSU9iamVjdD4oVUlPYmplY3RDbGFzczoge25ldyh4Om51bWJlciwgeTpudW1iZXIsIHo6bnVtYmVyLCAuLi5hcmdzOmFueSk6IFR9LCBhcmdzOiB7eDogbnVtYmVyLCB5Om51bWJlciwgejpudW1iZXJ9LCBzZXR1cEZuPzogRnVuY3Rpb24pe1xuICAgIGNvbnN0IHt4LCB5LCB6fSA9IGFyZ3NcbiAgICBjb25zdCBvYmplY3QgPSBuZXcgVUlPYmplY3RDbGFzcyh4LCB5LCB6KVxuICAgIGlmIChzZXR1cEZuKSBzZXR1cEZuKG9iamVjdCkgLy8gUHJvYmFibHkgYSBiZXR0ZXIgd2F5IG9mIGRvaW5nIHRoaXNcbiAgICB0aGlzLm9iamVjdHMucHVzaChvYmplY3QpXG4gICAgcmV0dXJuIG9iamVjdFxuICB9XG5cbiAgcmVmcmVzaFN0YXRlICgpIHtcbiAgICB0aGlzLmN1cnJlbnRVSVN0YXRlLmlkR3JpZCA9IEFycmF5LmZyb20oQXJyYXkoMzIpLCB4ID0+IEFycmF5KDMyKSlcblxuICAgIHRoaXMub2JqZWN0cyA9IHRoaXMub2JqZWN0cy5zb3J0KChhLCBiKSA9PiB7XG4gICAgICByZXR1cm4gYS5wb3NpdGlvbi56IC0gYi5wb3NpdGlvbi56XG4gICAgfSlcbiAgICB0aGlzLm9iamVjdHMuZm9yRWFjaCgodWlPYmplY3QpID0+IHtcbiAgICAgIGNvbnN0IHsgeCwgeSB9ID0gdWlPYmplY3QucG9zaXRpb25cbiAgICAgIC8vIENoZWNrIGlmIGF0IGludGVnZXIgcG9zaXRpb24sIGFuZCByZW5kZXIgdG8gc3RhdGUgZGlmZmVyZW50bHk/IChTZWUgSVN0YXRlIGludGVyZmFjZSlcbiAgICAgIHRoaXMuY3VycmVudFVJU3RhdGUuaWRHcmlkW3ldW3hdID0gdWlPYmplY3QuaWRcbiAgICB9KVxuICB9XG5cbiAgZ2V0U3RhdGUgKCk6SVN0YXRlIHtcbiAgICByZXR1cm4gdGhpcy5jdXJyZW50VUlTdGF0ZVxuICB9XG5cbiAgc2VsZWN0IDxUIGV4dGVuZHMgVUlPYmplY3Q+KHVpT2JqZWN0PzogVCkge1xuICAgIHRoaXMuc2VsZWN0ZWRPYmplY3QgPSB1aU9iamVjdCA/IHVpT2JqZWN0IDogdGhpcy5jdXJzb3JcbiAgfVxufSIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIExvZ2ljTW9kZWx7XG4gIGdldFN0YXRlKCk6SVN0YXRle3JldHVybn1cbn0iLCJpbXBvcnQgTG9naWNNb2RlbCBmcm9tICcuLi9sb2dpY01vZGVsJ1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBNZWRpYXRvciBpbXBsZW1lbnRzIExvZ2ljTW9kZWwge1xuICBsb2dpY01vZGVsOiBMb2dpY01vZGVsO1xuICBjb25zdHJ1Y3Rvcigpe1xuICAgIHRoaXMubG9naWNNb2RlbCA9IG5ldyBMb2dpY01vZGVsXG4gIH1cbiAgZ2V0U3RhdGUoKTpJU3RhdGV7XG4gICAgcmV0dXJuIHtcbiAgICAgIGlkR3JpZDogW1xuICAgICAgICBbMSwxLDAsMSwwLDFdLFxuICAgICAgICBbMSwxLDAsMSwwLDFdLFxuICAgICAgICBbMSwxLDAsMSwwLDFdLFxuICAgICAgICBbMSwxLDAsMSwwLDFdLFxuICAgICAgICBbMSwxLDAsMSwwLDFdLFxuICAgICAgICBbMSwxLDAsMSwwLDFdLFxuICAgICAgXVxuICAgIH1cbiAgfVxufSIsImltcG9ydCBJU3ByaXRlc2hlZXREYXRhIGZyb20gJ3NyYy9hc3NldHMvSVNwcml0ZXNoZWV0RGF0YSdcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgSW1hZ2VMb2FkZXIge1xuICBzdGF0aWMgYXN5bmMgbG9hZCguLi5zcHJpdGVzaGVldERhdGFBcnJheTogSVNwcml0ZXNoZWV0RGF0YVtdKSB7XG4gICAgc3ByaXRlc2hlZXREYXRhQXJyYXkuZm9yRWFjaChhc3luYyAoc3ByaXRlc2hlZXREYXRhKSA9PiB7XG4gICAgICBjb25zdCBzcHJpdGVzaGVldCA9IDxIVE1MSW1hZ2VFbGVtZW50PiBhd2FpdCBJbWFnZUxvYWRlci5hZGRJbWFnZVByb2Nlc3Moc3ByaXRlc2hlZXREYXRhLnBhdGgpXG4gICAgICBjb25zdCB0ZW1wQ29udGV4dCA9IEltYWdlTG9hZGVyLmdldENvbnRleHQoc3ByaXRlc2hlZXQpXG4gICAgICBmb3IgKGxldCBpZCBpbiBzcHJpdGVzaGVldERhdGEuZGF0YS5zcHJpdGVzKSB7XG4gICAgICAgIGxldCBzcHJpdGUgPSBzcHJpdGVzaGVldERhdGEuZGF0YS5zcHJpdGVzW2lkXVxuICAgICAgICBzcHJpdGUuaW1hZ2VEYXRhID0gSW1hZ2VMb2FkZXIuZ2V0SW1hZ2VEYXRhKHNwcml0ZSwgdGVtcENvbnRleHQpXG4gICAgICB9XG4gICAgfSlcbiAgfVxuXG4gIHN0YXRpYyBnZXRDb250ZXh0KGltYWdlOiBIVE1MSW1hZ2VFbGVtZW50KXtcbiAgICBjb25zdCBjYW52YXMgPSBJbWFnZUxvYWRlci5zZXR1cENhbnZhcyhpbWFnZSlcbiAgICBjb25zdCBjb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgY29udGV4dC5kcmF3SW1hZ2UoaW1hZ2UsIDAsIDApXG4gICAgcmV0dXJuIGNvbnRleHRcbiAgfVxuXG4gIHN0YXRpYyBzZXR1cENhbnZhcyhpbWFnZTpIVE1MSW1hZ2VFbGVtZW50KSB7XG4gICAgY29uc3QgY2FudmFzOkhUTUxDYW52YXNFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJylcbiAgICBjYW52YXMud2lkdGggPSBpbWFnZS53aWR0aDtcbiAgICBjYW52YXMuaGVpZ2h0ID0gaW1hZ2UuaGVpZ2h0O1xuICAgIHJldHVybiBjYW52YXNcbiAgfVxuXG4gIHN0YXRpYyBhZGRJbWFnZVByb2Nlc3Moc3JjOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgY29uc3QgaW1nOkhUTUxJbWFnZUVsZW1lbnQgPSBuZXcgSW1hZ2UoKTtcbiAgICAgIGltZy5vbmxvYWQgPSAoKSA9PiByZXNvbHZlKGltZyk7XG4gICAgICBpbWcub25lcnJvciA9IChlcnIpID0+IHJlamVjdChlcnIpO1xuICAgICAgaW1nLnNyYyA9IHNyYztcbiAgICB9KTtcbiAgfVxuXG4gIHN0YXRpYyBnZXRJbWFnZURhdGEgKHNwcml0ZTogSVNwcml0ZXNoZWV0RGF0YVsnZGF0YSddWydzcHJpdGVzJ11bMF0sIGNvbnRleHQ6Q2FudmFzUmVuZGVyaW5nQ29udGV4dDJEKTpJbWFnZURhdGEge1xuICAgIGNvbnN0IHt4LCB5LCB3LCBofSA9IHNwcml0ZVxuICAgIHJldHVybiBjb250ZXh0LmdldEltYWdlRGF0YSh4LCB5LCB3LCBoKVxuICB9XG59IiwiaW1wb3J0IElTcHJpdGVzaGVldERhdGEgZnJvbSAnLi4vSVNwcml0ZXNoZWV0RGF0YSdcblxuY29uc3QgdGVycmFpbnNoZWV0RGF0YTogSVNwcml0ZXNoZWV0RGF0YSA9IHtcbiAgcGF0aDogJ2Fzc2V0cy90ZXJyYWluL3Nwcml0ZVNoZWV0LnBuZycsXG4gIGRhdGE6IHtcbiAgICB0eXBlOiAndGVycmFpbicsXG4gICAgc3ByaXRlczoge1xuICAgICAgMDoge1xuICAgICAgICBuYW1lOiAnZ3Jhc3MnLFxuICAgICAgICB4OiAyMTcsIFxuICAgICAgICB5OiAxNTY3LCBcbiAgICAgICAgdzogMTYsIFxuICAgICAgICBoOiAxNiwgXG4gICAgICB9LFxuICAgICAgMToge1xuICAgICAgICBuYW1lOiAnc2VhJyxcbiAgICAgICAgeDogMzQwLFxuICAgICAgICB5OiAxNTY3LFxuICAgICAgICB3OiAxNixcbiAgICAgICAgaDogMTZcbiAgICAgIH0sXG4gICAgICAvLyBldGMuIGV0Yy5cbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgdGVycmFpbnNoZWV0RGF0YSIsImltcG9ydCBJU3ByaXRlc2hlZXREYXRhIGZyb20gJy4uL0lTcHJpdGVzaGVldERhdGEnXG4vLyBTdG9yZSB0aGVzZSBmaWxlcyBpbiBhc3NldHMgd2l0aCB0aGVpciBpbWFnZXM/XG5jb25zdCB1aXNoZWV0RGF0YTogSVNwcml0ZXNoZWV0RGF0YSAgPSB7XG4gIHBhdGg6ICdhc3NldHMvdWkvVUlTcHJpdGVzLnBuZycsXG4gIGRhdGE6IHtcbiAgICB0eXBlOiAnVUknLFxuICAgIHNwcml0ZXM6IHtcbiAgICAgIDA6IHtcbiAgICAgICAgbmFtZTogJ2N1cnNvcicsXG4gICAgICAgIHg6IDQ0LFxuICAgICAgICB5OiA2LFxuICAgICAgICB3OiAyOCxcbiAgICAgICAgaDogMzEsXG4gICAgICAgIGF4OiAtMyxcbiAgICAgICAgYXk6IC0zLFxuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCB1aXNoZWV0RGF0YSIsImltcG9ydCBWaWV3IGZyb20gJy4vdmlldy92aWV3J1xuaW1wb3J0IENvbnRyb2xsZXIgZnJvbSAnLi9jb250cm9sbGVyL2NvbnRyb2xsZXInXG5pbXBvcnQgVUlNb2RlbCBmcm9tICcuL21vZGVsL3VpTW9kZWwvdWlNb2RlbCdcbmltcG9ydCBNZWRpYXRvciBmcm9tICcuL21vZGVsL2xvZ2ljTW9kZWwvbWVkaWF0b3IvbWVkaWF0b3InXG5pbXBvcnQgSW1hZ2VMb2FkZXIgZnJvbSAnLi92aWV3L3N1YnJlbmRlcmVycy9pbWFnZUxvYWRlci9pbWFnZUxvYWRlcic7XG5pbXBvcnQgTG9naWNNb2RlbCBmcm9tICcuL21vZGVsL2xvZ2ljTW9kZWwvbG9naWNNb2RlbCc7XG5cbi8vIExvYWQgc3ByaXRlc2hlZXREYXRhIGJ5IGNvbmZpZz9cbmltcG9ydCB0ZXJyYWluc2hlZXREYXRhIGZyb20gJy4uL2Fzc2V0cy90ZXJyYWluL3RlcnJhaW5zaGVldERhdGEnXG5pbXBvcnQgdWlzaGVldERhdGEgZnJvbSAnLi4vYXNzZXRzL3VpL3VpU2hlZXREYXRhJ1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBFbmdpbmUge1xuICB2aWV3OiBWaWV3O1xuICBjb250cm9sbGVyOiBDb250cm9sbGVyO1xuICB1aU1vZGVsOiBVSU1vZGVsO1xuICBsb2dpY01vZGVsOiBMb2dpY01vZGVsO1xuICBjb25zdHJ1Y3RvciAoKSB7XG4gICAgLy8gdGhpcyBjb3VsZCBiZSBgbmV3IExvZ2ljTW9kZWwoKWAgaW4gYSBsb2NhbCB2ZXJzaW9uLCBhcyBtZWRpYXRvciB3aWxsIGltcGxlbWVudCB0aGUgTG9naWNNb2RlbCBpbnRlcmZhY2VcbiAgICB0aGlzLmxvZ2ljTW9kZWwgPSBuZXcgTWVkaWF0b3IoKVxuICAgIHRoaXMudWlNb2RlbCA9IG5ldyBVSU1vZGVsKHRoaXMubG9naWNNb2RlbClcblxuICAgIHRoaXMudmlldyA9IG5ldyBWaWV3KHRoaXMubG9naWNNb2RlbCwgdGhpcy51aU1vZGVsLCB7dGVycmFpbjogdGVycmFpbnNoZWV0RGF0YSwgdWk6IHVpc2hlZXREYXRhfSkgLy8gZ2V0IHNwcml0ZXNoZWV0IGRhdGEgZnJvbSBhIGNvbmZpZyBmaWxlP1xuICAgIHRoaXMuY29udHJvbGxlciA9IG5ldyBDb250cm9sbGVyKHRoaXMudWlNb2RlbCkgLy8gQW5kIHRoaXMudmlldyBpZiB1c2luZyBtb3VzZSBpbnB1dD9cblxuICAgIHRoaXMucGVyZm9ybUFzeW5jU2V0dXAoKVxuICB9XG5cbiAgYXN5bmMgcGVyZm9ybUFzeW5jU2V0dXAoKSB7XG4gICAgLy8gQ2FsbCBhbmQgYXdhaXQgYWxsIGluaXRpYWwgYXN5bmMgZnVuY3Rpb25zIGhlcmUuXG4gICAgLy8gRWcuIHRoaXMudmlldy5sb2FkU3ByaXRlc2hlZXRzKClcbiAgICBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICBJbWFnZUxvYWRlci5sb2FkKHRlcnJhaW5zaGVldERhdGEsIHVpc2hlZXREYXRhKVxuICAgICAgLy8gQW55IG90aGVyIGFzeW5jIHNldCB1cCBmdW5jdGlvbnNcbiAgICBdKVxuICAgIHRoaXMucnVuR2FtZSgpXG4gIH1cblxuICBydW5HYW1lKCl7XG4gICAgc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgdGhpcy52aWV3LnJlbmRlcigpXG4gICAgfSwgMTAwMCAvIDMwKVxuICB9XG59IiwiaW1wb3J0IEVuZ2luZSBmcm9tICcuLi9nYW1lRW5naW5lXzIvZW5naW5lJ1xuXG5leHBvcnQgZGVmYXVsdCBuZXcgY2xhc3MgQXBwIHtcbiAgcnVuICgpIHtcbiAgICBjb25zdCBlbmdpbmUgPSBuZXcgRW5naW5lKClcbiAgfVxufSIsImltcG9ydCBhcHAgZnJvbSAnLi9hcHAvYXBwJ1xuXG5hcHAucnVuKCkiXSwic291cmNlUm9vdCI6IiJ9