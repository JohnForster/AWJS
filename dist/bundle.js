!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";n.r(e);var r=function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{s(r.next(t))}catch(t){o(t)}}function u(t){try{s(r.throw(t))}catch(t){o(t)}}function s(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,u)}s((r=r.apply(t,e||[])).next())})},i=function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}},o=function(){function t(){this.ticksPerSecond=30,this.sprites=[],this.cursorTile={x:1,y:1},this.map=[[0,0,0,1,1,0],[0,0,0,1,1,0],[0,0,1,1,1,0],[0,1,1,1,1,0],[0,0,0,1,1,0],[1,1,0,1,1,1]],this.canvas=this.setupCanvas(),this.context=this.canvas.getContext("2d")}return t.prototype.setupCanvas=function(){var t=document.getElementById("canvas");return t.height=600,t.width=800,t},t.prototype.run=function(){return r(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return[4,this.loadSprites()];case 1:return t.sent(),this.gameTick(),[2]}})})},t.prototype.loadSprites=function(){return r(this,void 0,void 0,function(){var e,n;return i(this,function(r){switch(r.label){case 0:return[4,t.addImageProcess("assets/spriteSheet.png").then(function(t){return e=t})];case 1:return r.sent(),[4,t.addImageProcess("assets/UISprites.png").then(function(t){return n=t})];case 2:return r.sent(),this.sprites.push(t.getImageData(e,217,1567,16,16)),this.sprites.push(t.getImageData(e,340,1567,16,16)),this.sprites.push(t.getImageData(n,44,6,28,31)),[2]}})})},t.prototype.gameTick=function(){return r(this,void 0,void 0,function(){return i(this,function(t){return this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.printMap(this.map),this.printCursor(this.cursorTile,2),[2]})})},t.prototype.printMap=function(t){var e=this,n=document.createElement("canvas"),r=n.getContext("2d"),i={x:16,y:16};t.forEach(function(t,n){t.forEach(function(t,o){var a=o*i.x,u=n*i.y;r.putImageData(e.sprites[t],a,u)})});var o=this.getMapSize(t,i),a={x:Math.ceil((this.canvas.width-o.x)/2),y:20};this.context.drawImage(n,a.x,a.y)},t.prototype.getMapSize=function(t,e){return{x:t.length*e.x,y:t[0].length*e.y}},t.prototype.printCursor=function(t,e){var n=document.createElement("canvas"),r=n.getContext("2d");console.log(this.sprites),r.putImageData(this.sprites[e],0,0);var i=this.getMapSize(this.map,{x:16,y:16}),o=Math.ceil((this.canvas.width-i.x)/2),a=20,u=16*t.x+o-3,s=16*t.y+a-3;this.context.drawImage(n,u,s)},t.addImageProcess=function(t){return new Promise(function(e,n){var r=new Image;r.onload=function(){return e(r)},r.onerror=n,r.src=t})},t.getImageData=function(t,e,n,r,i){var o=document.createElement("canvas"),a=o.getContext("2d");return o.width=t.width,o.height=t.height,a.drawImage(t,0,0),a.getImageData(e,n,r,i)},t}();(new(function(){function t(){}return t.prototype.run=function(){(new o).run()},t}())).run()}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2dhbWVFbmdpbmUvZW5naW5lLnRzIiwid2VicGFjazovLy8uL3NyYy9hcHAvYXBwLnRzIiwid2VicGFjazovLy8uL3NyYy9pbmRleC50cyJdLCJuYW1lcyI6WyJpbnN0YWxsZWRNb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiZXhwb3J0cyIsIm1vZHVsZSIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsIkVuZ2luZSIsInRoaXMiLCJ0aWNrc1BlclNlY29uZCIsInNwcml0ZXMiLCJjdXJzb3JUaWxlIiwieCIsInkiLCJtYXAiLCJjYW52YXMiLCJzZXR1cENhbnZhcyIsImNvbnRleHQiLCJnZXRDb250ZXh0IiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImhlaWdodCIsIndpZHRoIiwicnVuIiwibG9hZFNwcml0ZXMiLCJfYSIsInNlbnQiLCJnYW1lVGljayIsImFkZEltYWdlUHJvY2VzcyIsInRoZW4iLCJyZXMiLCJzcHJpdGVTaGVldCIsIlVJU3ByaXRlcyIsInB1c2giLCJnZXRJbWFnZURhdGEiLCJjbGVhclJlY3QiLCJwcmludE1hcCIsInByaW50Q3Vyc29yIiwiX3RoaXMiLCJ0ZW1wQ2FudmFzIiwiY3JlYXRlRWxlbWVudCIsInRlbXBDb250ZXh0IiwidGlsZVNpemUiLCJmb3JFYWNoIiwicm93Iiwicm93TnVtYmVyIiwiaWQiLCJjb2xOdW1iZXIiLCJwdXRJbWFnZURhdGEiLCJtYXBTaXplIiwiZ2V0TWFwU2l6ZSIsInRvcCIsIk1hdGgiLCJjZWlsIiwiZHJhd0ltYWdlIiwibGVuZ3RoIiwiY29uc29sZSIsImxvZyIsInNyYyIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiaW1nIiwiSW1hZ2UiLCJvbmxvYWQiLCJvbmVycm9yIiwiaW1hZ2UiLCJ0b3BMZWZ0WCIsInRvcExlZnRZIiwiQXBwIiwiZ2FtZUVuZ2luZV9lbmdpbmUiXSwibWFwcGluZ3MiOiJhQUNBLElBQUFBLEVBQUEsR0FHQSxTQUFBQyxFQUFBQyxHQUdBLEdBQUFGLEVBQUFFLEdBQ0EsT0FBQUYsRUFBQUUsR0FBQUMsUUFHQSxJQUFBQyxFQUFBSixFQUFBRSxHQUFBLENBQ0FHLEVBQUFILEVBQ0FJLEdBQUEsRUFDQUgsUUFBQSxJQVVBLE9BTkFJLEVBQUFMLEdBQUFNLEtBQUFKLEVBQUFELFFBQUFDLElBQUFELFFBQUFGLEdBR0FHLEVBQUFFLEdBQUEsRUFHQUYsRUFBQUQsUUFLQUYsRUFBQVEsRUFBQUYsRUFHQU4sRUFBQVMsRUFBQVYsRUFHQUMsRUFBQVUsRUFBQSxTQUFBUixFQUFBUyxFQUFBQyxHQUNBWixFQUFBYSxFQUFBWCxFQUFBUyxJQUNBRyxPQUFBQyxlQUFBYixFQUFBUyxFQUFBLENBQTBDSyxZQUFBLEVBQUFDLElBQUFMLEtBSzFDWixFQUFBa0IsRUFBQSxTQUFBaEIsR0FDQSxvQkFBQWlCLGVBQUFDLGFBQ0FOLE9BQUFDLGVBQUFiLEVBQUFpQixPQUFBQyxZQUFBLENBQXdEQyxNQUFBLFdBRXhEUCxPQUFBQyxlQUFBYixFQUFBLGNBQWlEbUIsT0FBQSxLQVFqRHJCLEVBQUFzQixFQUFBLFNBQUFELEVBQUFFLEdBRUEsR0FEQSxFQUFBQSxJQUFBRixFQUFBckIsRUFBQXFCLElBQ0EsRUFBQUUsRUFBQSxPQUFBRixFQUNBLEtBQUFFLEdBQUEsaUJBQUFGLFFBQUFHLFdBQUEsT0FBQUgsRUFDQSxJQUFBSSxFQUFBWCxPQUFBWSxPQUFBLE1BR0Es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QUFNQSxLQUlQbkQsRUFBQTJCLGFBQVAsU0FBb0JnQyxFQUF5QkMsRUFBaUJDLEVBQWlCOUMsRUFBY0QsR0FDM0YsSUFBTWtCLEVBQWFwQixTQUFTcUIsY0FBYyxVQUNwQ0MsRUFBY0YsRUFBV3JCLFdBQVcsTUFJMUMsT0FIQXFCLEVBQVdqQixNQUFRNEMsRUFBTTVDLE1BQ3pCaUIsRUFBV2xCLE9BQVM2QyxFQUFNN0MsT0FDMUJvQixFQUFZYSxVQUFVWSxFQUFPLEVBQUcsR0FDekJ6QixFQUFZUCxhQUFhaUMsRUFBVUMsRUFBVTlDLEVBQU9ELElBSS9EZCxFQS9HQSxJQ0VlLGVBQUksU0FBQThELEtBS25CLE9BSkVBLEVBQUFsRSxVQUFBb0IsSUFBQSxZQUNpQixJQUFJK0MsR0FDWi9DLE9BRVg4QyxFQUxlLEtDQVg5QyIsImZpbGUiOiJidW5kbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBnZXR0ZXIgfSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uciA9IGZ1bmN0aW9uKGV4cG9ydHMpIHtcbiBcdFx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG4gXHRcdH1cbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbiBcdH07XG5cbiBcdC8vIGNyZWF0ZSBhIGZha2UgbmFtZXNwYWNlIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0XG4gXHQvLyBtb2RlICYgMjogbWVyZ2UgYWxsIHByb3BlcnRpZXMgb2YgdmFsdWUgaW50byB0aGUgbnNcbiBcdC8vIG1vZGUgJiA0OiByZXR1cm4gdmFsdWUgd2hlbiBhbHJlYWR5IG5zIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDh8MTogYmVoYXZlIGxpa2UgcmVxdWlyZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy50ID0gZnVuY3Rpb24odmFsdWUsIG1vZGUpIHtcbiBcdFx0aWYobW9kZSAmIDEpIHZhbHVlID0gX193ZWJwYWNrX3JlcXVpcmVfXyh2YWx1ZSk7XG4gXHRcdGlmKG1vZGUgJiA4KSByZXR1cm4gdmFsdWU7XG4gXHRcdGlmKChtb2RlICYgNCkgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAmJiB2YWx1ZS5fX2VzTW9kdWxlKSByZXR1cm4gdmFsdWU7XG4gXHRcdHZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18ucihucyk7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShucywgJ2RlZmF1bHQnLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2YWx1ZSB9KTtcbiBcdFx0aWYobW9kZSAmIDIgJiYgdHlwZW9mIHZhbHVlICE9ICdzdHJpbmcnKSBmb3IodmFyIGtleSBpbiB2YWx1ZSkgX193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBrZXksIGZ1bmN0aW9uKGtleSkgeyByZXR1cm4gdmFsdWVba2V5XTsgfS5iaW5kKG51bGwsIGtleSkpO1xuIFx0XHRyZXR1cm4gbnM7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMCk7XG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBFbmdpbmUge1xuICBjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50O1xuICBjb250ZXh0OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQ7XG4gIHRpY2tzUGVyU2Vjb25kOiBudW1iZXIgPSAzMDsgLy8gc2V0IHRpY2tzUGVyU2Vjb25kIGluIGNvbmZpZz9cbiAgc3ByaXRlczogSW1hZ2VEYXRhW10gPSBbXTtcbiAgY3Vyc29yVGlsZSA9IHsgeDogMSwgeTogMSB9XG5cbiAgbWFwOiBudW1iZXJbXVtdID0gW1xuICAgIFswLDAsMCwxLDEsMF0sXG4gICAgWzAsMCwwLDEsMSwwXSxcbiAgICBbMCwwLDEsMSwxLDBdLFxuICAgIFswLDEsMSwxLDEsMF0sXG4gICAgWzAsMCwwLDEsMSwwXSxcbiAgICBbMSwxLDAsMSwxLDFdLFxuICBdXG4gIFxuICBjb25zdHJ1Y3RvciAoKSB7XG4gICAgdGhpcy5jYW52YXMgPSB0aGlzLnNldHVwQ2FudmFzKCk7XG4gICAgdGhpcy5jb250ZXh0ID0gdGhpcy5jYW52YXMuZ2V0Q29udGV4dCgnMmQnKVxuICB9XG5cbiAgcHJpdmF0ZSBzZXR1cENhbnZhcygpOiBIVE1MQ2FudmFzRWxlbWVudCB7XG4gICAgY29uc3QgY2FudmFzID0gPEhUTUxDYW52YXNFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW52YXMnKTtcbiAgICBjYW52YXMuaGVpZ2h0ID0gNjAwOyAvLyBzZXQgZGltZW5zaW9ucyBpbiBjb25maWc/XG4gICAgY2FudmFzLndpZHRoID0gODAwO1xuICAgIHJldHVybiBjYW52YXM7XG4gIH1cblxuICBhc3luYyBydW4gKCkge1xuICAgIGF3YWl0IHRoaXMubG9hZFNwcml0ZXMoKVxuICAgIHRoaXMuZ2FtZVRpY2soKVxuICAgIC8vIHNldEludGVydmFsKHRoaXMuZ2FtZVRpY2suYmluZCh0aGlzKSwgMTAwMC90aGlzLnRpY2tzUGVyU2Vjb25kKVxuICB9XG5cbiAgYXN5bmMgbG9hZFNwcml0ZXMgKCkge1xuICAgIGxldCBzcHJpdGVTaGVldDogSFRNTEltYWdlRWxlbWVudFxuICAgIGxldCBVSVNwcml0ZXM6IEhUTUxJbWFnZUVsZW1lbnRcbiAgICBhd2FpdCBFbmdpbmUuYWRkSW1hZ2VQcm9jZXNzKCdhc3NldHMvc3ByaXRlU2hlZXQucG5nJylcbiAgICAudGhlbihyZXMgPT4gc3ByaXRlU2hlZXQgPSA8SFRNTEltYWdlRWxlbWVudD5yZXMpXG4gICAgYXdhaXQgRW5naW5lLmFkZEltYWdlUHJvY2VzcygnYXNzZXRzL1VJU3ByaXRlcy5wbmcnKVxuICAgIC50aGVuKHJlcyA9PiBVSVNwcml0ZXMgPSA8SFRNTEltYWdlRWxlbWVudD5yZXMpXG4gICAgdGhpcy5zcHJpdGVzLnB1c2goRW5naW5lLmdldEltYWdlRGF0YShzcHJpdGVTaGVldCwgMjE3LCAxNTY3LCAxNiwgMTYpKSAvLyBncmFzc1xuICAgIHRoaXMuc3ByaXRlcy5wdXNoKEVuZ2luZS5nZXRJbWFnZURhdGEoc3ByaXRlU2hlZXQsIDM0MCwgMTU2NywgMTYsIDE2KSkgLy8gc2VhXG4gICAgdGhpcy5zcHJpdGVzLnB1c2goRW5naW5lLmdldEltYWdlRGF0YShVSVNwcml0ZXMsIDQ0LCA2LCAyOCwgMzEpKSAvLyBjdXJzb3JcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZ2FtZVRpY2sgKCkge1xuICAgIHRoaXMuY29udGV4dC5jbGVhclJlY3QoMCwgMCwgdGhpcy5jYW52YXMud2lkdGgsIHRoaXMuY2FudmFzLmhlaWdodClcbiAgICAvLyBjb25zdCBtYXAgPSB0aGlzLmdhbWUuY3VycmVudE1hcFN0YXRlXG4gICAgLy8gY29uc3QgdW5pdHMgPSB0aGlzLmdhbWUuY3VycmVudFVuaXRTdGF0ZSAvLyBNYXAgY2xhc3MgaG9sZHMgY3VycmVudCBtYXAgZGF0YT9cbiAgICAvLyB0aGlzLnJlbmRlcmVyLmRyYXdNYXAobWFwKVxuICAgIC8vIHRoaXMucmVuZGVyZXIuZHJhd1VuaXRzKHVuaXRzKVxuICAgIC8vIFRPRE8gbW92ZSBpbnRvIHJlbmRlcmVyIGNsYXNzLlxuICAgIHRoaXMucHJpbnRNYXAodGhpcy5tYXApXG4gICAgdGhpcy5wcmludEN1cnNvcih0aGlzLmN1cnNvclRpbGUsIDIpXG4gIH1cblxuICBwcml2YXRlIHByaW50TWFwIChtYXA6IG51bWJlcltdW10pIHtcbiAgICBjb25zdCB0ZW1wQ2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xuICAgIGNvbnN0IHRlbXBDb250ZXh0OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQgPSB0ZW1wQ2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgY29uc3QgdGlsZVNpemUgPSB7IHg6MTYsIHk6MTZ9XG4gICAgbWFwLmZvckVhY2goKHJvdywgcm93TnVtYmVyKSA9PiB7XG4gICAgICByb3cuZm9yRWFjaCgoaWQsIGNvbE51bWJlcikgPT4ge1xuICAgICAgICBjb25zdCB4ID0gKGNvbE51bWJlciAqIHRpbGVTaXplLngpXG4gICAgICAgIGNvbnN0IHkgPSAocm93TnVtYmVyICogdGlsZVNpemUueSlcbiAgICAgICAgdGVtcENvbnRleHQucHV0SW1hZ2VEYXRhKHRoaXMuc3ByaXRlc1tpZF0sIHgsIHkpXG4gICAgICB9KVxuICAgIH0pXG4gICAgY29uc3QgbWFwU2l6ZSA9IHRoaXMuZ2V0TWFwU2l6ZShtYXAsIHRpbGVTaXplKVxuICAgIGNvbnN0IHRvcCA9IHsgeDogTWF0aC5jZWlsKCh0aGlzLmNhbnZhcy53aWR0aCAtIG1hcFNpemUueCkgLyAyKSwgeTogMjAgfTtcbiAgICB0aGlzLmNvbnRleHQuZHJhd0ltYWdlKHRlbXBDYW52YXMsIHRvcC54LCB0b3AueSlcbiAgfVxuXG4gIHByaXZhdGUgZ2V0TWFwU2l6ZShtYXA6IG51bWJlcltdW10sIHRpbGVTaXplOiB7IHg6IG51bWJlcjsgeTogbnVtYmVyOyB9KSB7XG4gICAgcmV0dXJuIHsgeDogKG1hcC5sZW5ndGggKiB0aWxlU2l6ZS54KSwgeTogKG1hcFswXS5sZW5ndGggKiB0aWxlU2l6ZS55KSB9O1xuICB9XG5cbiAgcHJpdmF0ZSBwcmludEN1cnNvcihjdXJzb3JUaWxlOmFueSwgaWQ6bnVtYmVyKSB7XG5cbiAgICBjb25zdCB0ZW1wQ2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xuICAgIGNvbnN0IHRlbXBDb250ZXh0OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQgPSB0ZW1wQ2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgY29uc29sZS5sb2codGhpcy5zcHJpdGVzKVxuICAgIHRlbXBDb250ZXh0LnB1dEltYWdlRGF0YSh0aGlzLnNwcml0ZXNbaWRdLCAwLCAwKTtcbiAgICBjb25zdCBtYXBTaXplID0gdGhpcy5nZXRNYXBTaXplKHRoaXMubWFwLCB7eDoxNiwgeToxNn0pXG4gICAgY29uc3QgdG9wID0geyB4OiBNYXRoLmNlaWwoKHRoaXMuY2FudmFzLndpZHRoIC0gbWFwU2l6ZS54KSAvIDIpLCB5OiAyMCB9O1xuICAgIGNvbnN0IHggPSBjdXJzb3JUaWxlLnggKiAxNiArIHRvcC54IC0gM1xuICAgIGNvbnN0IHkgPSBjdXJzb3JUaWxlLnkgKiAxNiArIHRvcC55IC0gM1xuICAgIHRoaXMuY29udGV4dC5kcmF3SW1hZ2UodGVtcENhbnZhcywgeCwgeSlcbiAgfVxuXG5cblxuICBzdGF0aWMgYWRkSW1hZ2VQcm9jZXNzKHNyYzogc3RyaW5nKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGNvbnN0IGltZzpIVE1MSW1hZ2VFbGVtZW50ID0gbmV3IEltYWdlKCk7XG4gICAgICBpbWcub25sb2FkID0gKCkgPT4gcmVzb2x2ZShpbWcpO1xuICAgICAgaW1nLm9uZXJyb3IgPSByZWplY3Q7XG4gICAgICBpbWcuc3JjID0gc3JjO1xuICAgIH0pO1xuICB9XG5cbiAgc3RhdGljIGdldEltYWdlRGF0YShpbWFnZTogSFRNTEltYWdlRWxlbWVudCwgdG9wTGVmdFg6bnVtYmVyLCB0b3BMZWZ0WTpudW1iZXIsIHdpZHRoOm51bWJlciwgaGVpZ2h0Om51bWJlcik6SW1hZ2VEYXRhIHtcbiAgICBjb25zdCB0ZW1wQ2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XG4gICAgY29uc3QgdGVtcENvbnRleHQgPSB0ZW1wQ2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgdGVtcENhbnZhcy53aWR0aCA9IGltYWdlLndpZHRoO1xuICAgIHRlbXBDYW52YXMuaGVpZ2h0ID0gaW1hZ2UuaGVpZ2h0O1xuICAgIHRlbXBDb250ZXh0LmRyYXdJbWFnZShpbWFnZSwgMCwgMClcbiAgICByZXR1cm4gdGVtcENvbnRleHQuZ2V0SW1hZ2VEYXRhKHRvcExlZnRYLCB0b3BMZWZ0WSwgd2lkdGgsIGhlaWdodClcbiAgfVxuXG5cbn0iLCJpbXBvcnQgRW5naW5lIGZyb20gJy4uL2dhbWVFbmdpbmUvZW5naW5lJ1xuXG5leHBvcnQgZGVmYXVsdCBuZXcgY2xhc3MgQXBwIHtcbiAgcnVuICgpIHtcbiAgICBjb25zdCBlbmdpbmUgPSBuZXcgRW5naW5lKClcbiAgICBlbmdpbmUucnVuKClcbiAgfVxufSIsImltcG9ydCBhcHAgZnJvbSAnLi9hcHAvYXBwJ1xuXG5hcHAucnVuKCkiXSwic291cmNlUm9vdCI6IiJ9